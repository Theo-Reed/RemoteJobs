<view class="page">
  <view class="me-card" bindtap="onAvatarTap">
    <view class="user-row">
      <block wx:if="{{userInfo}}">
        <image class="avatar" src="{{userInfo.avatarUrl}}"/>
      </block>
      <block wx:else>
        <view class="avatar-placeholder"></view>
      </block>

      <view class="user-text">
        <block wx:if="{{isInitialLoading}}">
          <text class="nickname">加载中...</text>
        </block>
        <block wx:elif="{{!isLoggedIn}}">
          <button
                  class="phone-auth-name-btn"
                  open-type="getPhoneNumber"
                  bindgetrealtimephonenumber="onGetRealtimePhoneNumber"
                  bindgetphonenumber="onGetPhoneNumber"
          >
            <text class="nickname nickname-login">{{ui.userNotLoggedIn}}</text>
          </button>
        </block>
        <block wx:else>
          <view class="nickname-container">
            <text class="nickname">{{userInfo ? userInfo.nickName : '已登录'}}</text>
            <view wx:if="{{memberLevel > 0 && memberBadgeText}}" class="member-badge {{memberLevel === 1 ? 'member-badge-trial' : (memberLevel === 2 ? 'member-badge-normal' : 'member-badge-premium')}}">
              <text class="member-text">{{memberBadgeText}}</text>
            </view>
          </view>
        </block>
      </view>
    </view>
  </view>

  <view class="me-list">
    <view class="me-item" bindtap="onResumeProfileTap">
      <text class="me-item-text">{{ui.resumeProfileEntry}}</text>
    </view>
    <view class="me-item" bindtap="onAppliedJobsTap">
      <text class="me-item-text">{{ui.appliedJobsEntry}}</text>
    </view>
    <view class="me-item" bindtap="onAiTranslateTap">
      <text class="me-item-text">{{ui.aiTranslateEntry}}</text>
    </view>
    <view class="me-item" bindtap="onLanguageTap">
      <text class="me-item-text">{{ui.language}}</text>
    </view>
    <view class="me-item" bindtap="onInviteTap">
      <text class="me-item-text">{{ui.inviteCodeEntry}}</text>
    </view>
  </view>

  <!-- Language bottom sheet (same animation as saved sheet) -->
  <block wx:if="{{showLanguageSheet}}">
    <view class="bottom-sheet-mask {{languageSheetOpen ? 'bottom-sheet-mask-open' : ''}}"
          bindtap="closeLanguageSheet"></view>
    <view class="bottom-sheet {{languageSheetOpen ? 'bottom-sheet-open' : ''}}">

      <view class="bottom-sheet-content">
        <view class="language-item {{currentLanguage === 'Chinese' ? 'language-item-active' : ''}}"
              data-value="Chinese" bindtap="onLanguageSelect">
          <text class="language-item-text">{{ui.langDefault}}</text>
        </view>
        <view class="language-item {{currentLanguage === 'English' ? 'language-item-active' : ''}}"
              data-value="English" bindtap="onLanguageSelect">
          <view class="language-item-text">
            <text>{{ui.langEnglish}}</text>
            <image class="member-star-icon" src="/assets/icons/four-point-star-twin.png" mode="aspectFit"/>
          </view>
        </view>

      </view>
    </view>
  </block>

  <!-- AI Translate bottom sheet -->
  <block wx:if="{{showAiTranslateSheet}}">
    <view class="bottom-sheet-mask {{aiTranslateSheetOpen ? 'bottom-sheet-mask-open' : ''}}"
          bindtap="closeAiTranslateSheet"></view>
    <view class="bottom-sheet {{aiTranslateSheetOpen ? 'bottom-sheet-open' : ''}}">

      <view class="bottom-sheet-content">
        <view class="language-item {{aiTranslateLanguage === 'Default' ? 'language-item-active' : ''}}"
              data-value="Default" bindtap="onAiTranslateLanguageSelect">
          <text class="language-item-text">{{ui.aiTranslateDefault}}</text>
        </view>
        <view class="language-item {{aiTranslateLanguage === 'AIChinese' ? 'language-item-active' : ''}}"
              data-value="AIChinese" bindtap="onAiTranslateLanguageSelect">
          <view class="language-item-text">
            <text>{{ui.langAI}}</text>
            <image class="member-star-icon" src="/assets/icons/four-point-star-twin.png" mode="aspectFit"/>
          </view>
        </view>
      </view>
    </view>
  </block>

  <!-- Invite code bottom sheet -->
  <block wx:if="{{showInviteSheet}}">
    <view class="bottom-sheet-mask {{inviteSheetOpen ? 'bottom-sheet-mask-open' : ''}}"
          bindtap="closeInviteSheet"></view>
    <view class="bottom-sheet {{inviteSheetOpen ? 'bottom-sheet-open' : ''}}">

      <view class="bottom-sheet-content invite-sheet-content">
        <view class="invite-section">
          <text class="invite-section-title">{{ui.myInviteCode}}</text>
          <view class="invite-code-display" bindtap="onCopyInviteCode">
            <text class="invite-code-text">{{myInviteCode}}</text>
            <text class="invite-code-copy">复制</text>
          </view>
        </view>

        <view class="invite-section">
          <text class="invite-section-title">{{ui.inputInviteCode}}</text>
          <input
                  class="invite-code-input"
                  type="text"
                  placeholder="请输入邀请码"
                  value="{{inputInviteCode}}"
                  bindinput="onInviteCodeInput"
          />
          <button class="invite-apply-btn" bindtap="onApplyInviteCode">应用</button>
        </view>
      </view>
    </view>
  </block>

  <!-- User Profile Sheet -->
  <include src="./profile-sheet.wxml"/>
</view>
